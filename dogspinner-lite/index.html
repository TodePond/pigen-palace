<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script data-goatcounter="https://pigenpalace.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
<img id="dog" />
<img id="title" src="images/title.gif" style="display: none" />
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    margin: 0;
    background-color: #f0f0f0;
    transition: filter 0.5s ease-in-out;
  }

  * {
    overscroll-behavior: none;
  }
  img {
    object-fit: cover;
    height: 100%;
    position: absolute;
    width: 100%;
  }

  #title {
    /* inverse of the above */
    clip-path: inset(0 0 60% 0);
  }
</style>
<script type="module">
  const body = document.body;

  function preloadImage(src) {
    const img = new Image();
    img.src = src;
  }

  preloadImage("images/dog-0.gif");
  preloadImage("images/dog-1.gif");
  preloadImage("images/dog-2.gif");
  preloadImage("images/dog-3.gif");
  preloadImage("images/title.gif");

  const dogImg = document.getElementById("dog");
  const titleImg = document.getElementById("title");

  const MIN_DOG_SPEED = 0;
  const MAX_DOG_SPEED = 3;
  const state = {
    dogSpeed: 1,
    titleVisible: false,
  };

  function wrap(n, min, max) {
    while (n < min) n += max - min + 1;
    while (n > max) n -= max - min + 1;
    return n;
  }

  addEventListener("keydown", (event) => {
    switch (event.key) {
      case "ArrowUp": {
        state.titleVisible = !state.titleVisible;
        break;
      }
      case "ArrowDown": {
        state.titleVisible = !state.titleVisible;
        break;
      }
      case "ArrowLeft": {
        state.dogSpeed = wrap(state.dogSpeed - 1, MIN_DOG_SPEED, MAX_DOG_SPEED);
        break;
      }
      case "ArrowRight": {
        state.dogSpeed = wrap(state.dogSpeed + 1, MIN_DOG_SPEED, MAX_DOG_SPEED);
        break;
      }
      case " ": {
        body.style.filter = body.style.filter === "invert(1)" ? "none" : "invert(1)";
        break;
      }
    }

    updateImages();
  });

  let currentDogSrc = "";
  function updateImages() {
    const newDogSrc = `images/dog-${state.dogSpeed}.gif`;
    if (newDogSrc !== currentDogSrc) {
      console.log("update", currentDogSrc, "->", newDogSrc);
      dogImg.src = newDogSrc;
      currentDogSrc = newDogSrc;
    }
    titleImg.style.display = state.titleVisible ? "block" : "none";
  }

  updateImages();
</script>
